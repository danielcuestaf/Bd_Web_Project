<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Actualizar_BD</title>

  <style id="" media="all">
    /* cyrillic-ext */
    @font-face {
      font-family: 'Montserrat';
      font-style: normal;
      font-weight: 400;
      font-display: swap;
      src: url(./fonts/montserrat.woff2) format('woff2');
      unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
    }

    /* cyrillic */
    @font-face {
      font-family: 'Montserrat';
      font-style: normal;
      font-weight: 400;
      font-display: swap;
      src: url(./fonts/montserrat.woff2) format('woff2');
      unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
    }

    /* vietnamese */
    @font-face {
      font-family: 'Montserrat';
      font-style: normal;
      font-weight: 400;
      font-display: swap;
      src: url(./fonts/montserrat.woff2) format('woff2');
      unicode-range: U+0102-0103, U+0110-0111, U+0128-0129, U+0168-0169, U+01A0-01A1, U+01AF-01B0, U+0300-0301, U+0303-0304, U+0308-0309, U+0323, U+0329, U+1EA0-1EF9, U+20AB;
    }

    /* latin-ext */
    @font-face {
      font-family: 'Montserrat';
      font-style: normal;
      font-weight: 400;
      font-display: swap;
      src: url(./fonts/montserrat.woff2) format('woff2');
      unicode-range: U+0100-02AF, U+0304, U+0308, U+0329, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
    }

    /* latin */
    @font-face {
      font-family: 'Montserrat';
      font-style: normal;
      font-weight: 400;
      font-display: swap;
      src: url(./fonts/montserrat.woff2) format('woff2');
      unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
    }

    /* cyrillic-ext */
    @font-face {
      font-family: 'Montserrat';
      font-style: normal;
      font-weight: 700;
      font-display: swap;
      src: url(./fonts/montserrat.woff2) format('woff2');
      unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
    }

    /* cyrillic */
    @font-face {
      font-family: 'Montserrat';
      font-style: normal;
      font-weight: 700;
      font-display: swap;
      src: url(./fonts/montserrat.woff2) format('woff2');
      unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
    }

    /* vietnamese */
    @font-face {
      font-family: 'Montserrat';
      font-style: normal;
      font-weight: 700;
      font-display: swap;
      src: url(./fonts/montserrat.woff2) format('woff2');
      unicode-range: U+0102-0103, U+0110-0111, U+0128-0129, U+0168-0169, U+01A0-01A1, U+01AF-01B0, U+0300-0301, U+0303-0304, U+0308-0309, U+0323, U+0329, U+1EA0-1EF9, U+20AB;
    }

    /* latin-ext */
    @font-face {
      font-family: 'Montserrat';
      font-style: normal;
      font-weight: 700;
      font-display: swap;
      src: url(./fonts/montserrat.woff2) format('woff2');
      unicode-range: U+0100-02AF, U+0304, U+0308, U+0329, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
    }

    /* latin */
    @font-face {
      font-family: 'Montserrat';
      font-style: normal;
      font-weight: 700;
      font-display: swap;
      src: url(./fonts/montserrat.woff2) format('woff2');
      unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
    }
  </style>

  <link type="text/css" rel="stylesheet" href="css/bootstrap.min.css" />
  <link type="text/css" rel="stylesheet" href="css/style.css" />
  <!--[if lt IE 9]>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
		<![endif]-->

  <meta name="robots" content="noindex, follow">
</head>

<body>
  <div id="booking" class="section">
    <div class="section-center">
      <div class="container">
        <div class="row">
          <div class="col-md-7 col-md-push-5">
            <div class="booking-cta">
              <h1>Para Usar el Servicio</h1>
              <p style="font-size: 20px;">Porfavor llenar el siguiente formulario para ingresar o actualizar datos en la base de datos, en caso
                de que exista el ususario se le dara un aviso</p>
              </p>
            </div>
            <!--alert-->
            <div class="alert alert-danger" id="alerta-d" role="alert" style="font-size: 20px;"><strong>¡Error!</strong> Información faltante
            </div>
            <div class="alert alert-warning" id="alerta-w" role="alert" style="font-size: 20px;"><strong>¡Peligro!</strong> El usuario ya existe,
              ¿desea
              actulizar?<a href="#" onclick="Bd_put()" class="alert-link text-center"> SI</a><br>En caso contrario por favor ingrese un documento que no este repetido.
            </div>
            <div class="alert alert-success" id="alerta-s" role="alert" style="font-size: 20px;"><strong>¡Exito!</strong>
              Persona creada correctamente
            </div>
          
          </div>
          <div class="col-md-5 col-md-pull-7">
            <div class="booking-form">
              <form>
                <div class="row">
                  <div class="col-sm-6">
                    <div class="form-group">
                      <span class="form-label">Direccion</span>
                      <input class="form-control" type="text" name="direccion" placeholder="Direccion">
                    </div>
                  </div>
                  <div class="col-sm-6">
                    <div class="form-group">
                      <span class="form-label">Celular</span>
                      <input class="form-control" type="number" name="celular" placeholder="Celular">
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col-sm-6">
                    <div class="form-group">
                      <span class="form-label">Nombre</span>
                      <input class="form-control" type="text" placeholder="Nombre" name="nombre" required>
                    </div>
                  </div>
                  <div class="col-sm-6">
                    <div class="form-group">
                      <span class="form-label">Apellido</span>
                      <input class="form-control" type="text" placeholder="Apellido" name="apellido" required>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col-sm-8">
                    <div class="form-group">
                      <span class="form-label">Numero de documento</span>
                      <input class="form-control" type="text" name="nDoc" placeholder="Numero de documento" required>
                    </div>
                  </div>
                  <div class="col-sm-4">
                    <div class="form-group">
                      <span class="form-label">Tipo</span>
                      <select id="tipos" class="form-control" name="tipoDoc" required="required"></select>
                      <span class="select-arrow"></span>
                    </div>
                  </div>
                </div>
                <div class="form-group">
                  <span class="form-label">Correo</span>
                  <input class="form-control" type="email" placeholder="Correo" name="correo" required>
                </div>
                <div class="form-btn text-center">
                  <button class="submit-btn">Agregar</button>
                  <button type="button" class="submit-btn" onclick="location.href = './tabla.html'" >Volver</button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="./js/jquery.min.js"></script>
  <script src="./js/bootstrap.min.js"></script>
  <script>
    $('#alerta-d').hide();
    $('#alerta-w').hide();
    $('#alerta-s').hide();
    // Handler para el evento de respuesta de la petición
    document.querySelector("form").addEventListener("submit", function (e) {
      // Enviar la petición al servidor
      const datos = new FormData(document.querySelector("form"))
      const data = {
        nombre: datos.get("nombre"),
        nDoc: datos.get("nDoc"),
        tipoDoc: datos.get("tipoDoc"),
        apellido: datos.get("apellido"),
        direccion: datos.get("direccion"),
        correo: datos.get("correo"),
        celular: datos.get("celular")

      };
      const jsonData = JSON.stringify(data);

      fetch("http://localhost:3000/api/personas", {
        method: "POST",
        body: jsonData,
        headers: {
          'Content-Type': 'application/json'
        }
      })
        .then(function (response) {
          if (response.status === 400) {
            $('#alerta-w').hide();
            $('#alerta-s').hide();
            $('#alerta-d').show();
          } else if (response.status === 409) {
            $('#alerta-d').hide();
            $('#alerta-s').hide();
            $('#alerta-w').show();
          } else if (response.status === 201) {
            $('#alerta-d').hide();
            $('#alerta-w').hide();
            $('#alerta-s').show();
            //location.href = "./tabla.html";
          }
        })
        .catch(function (error) {
          alert("Error en la petición");
        });
      e.preventDefault();
    });
  </script>

  <script>
    function Bd_put() {
      const datos = new FormData(document.querySelector("form"))
      const data = {
        nombre: datos.get("nombre"),
        nDoc: datos.get("nDoc"),
        tipoDoc: datos.get("tipoDoc"),
        apellido: datos.get("apellido"),
        direccion: datos.get("direccion"),
        correo: datos.get("correo"),
        celular: datos.get("celular")

      };
      const jsonData = JSON.stringify(data);

      const url = 'http://localhost:3000/api/personas/' + datos.get("tipoDoc") + '/' + datos.get("nDoc");
      alert(url);
      const form = document.querySelector('form');
      const options = {
        method: 'PUT',
        body: jsonData,
        headers: {
          'Content-Type': 'application/json'
        }
      };
      fetch(url, options)
        .then(function (response) {
          if (response.status === 400) {
            alert("400");
          } else if (response.status === 500) {
            alert("500");
          } else if (response.status === 404) {
            alert("404");
          } else if (response.status === 200) {
            location.href = "./tabla.html";
          }
        })
        .then(data => console.log(data))
        .catch(error => console.error(error));
    }
  </script>

  <script>

    const traerDatos = async () => {
      const response = await fetch('http://localhost:3000/api/tipodoc')
      const data = await response.json()

      console.log(data)
      var miTipo = document.getElementById('tipos');

      for (let i = 0; i < data.length; i++) {
        miTipo.innerHTML += crearTipo(data[i])
      }
    }
    traerDatos()

    function crearTipo(tipo) {
      return `<option value="${tipo[0]}">${tipo[1]}</option>`
    }

    e.preventDefault();



  </script>
</body>

</html>